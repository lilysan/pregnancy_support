<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Translate | Pregnancy Support</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="stylesheet" href="../reset.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="../style.css">
</head>
<body>
<div class="container">
    <div class="loader">
        <div class="text-center">
            <div class="spinner-border" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    </div>

    <h1 class="title_link mt-3">Translate App List</h1>
    <h3 class="mt-3">DeepL</h3>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://deepl.com" class="btn btn-primary app-deepl" type="button">App</a>
        </div>
        <div class="col d-grid">
            <a href="https://deepl.com" class="btn btn-primary web-deepl" type="button">Web</a>
        </div>
    </div>

    <h3 class="mt-3">Google Translate</h3>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://translate.google.com" class="btn btn-primary app-google" type="button">App</a>
        </div>
        <div class="col d-grid">
            <a href="https://translate.google.com" class="btn btn-primary web-google" type="button">Web</a>
        </div>
    </div>

    <h3 class="mt-3">iTranslate Translator</h3>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://whfs.app.link" class="btn btn-primary app-iTranslate" type="button">App</a>
        </div>
        <div class="col d-grid"></div>
    </div>

    <h3 class="mt-3">Microsoft Translator</h3>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://translate.it" class="btn btn-primary app-microsoft" type="button">App</a>
        </div>
        <div class="col d-grid">
            <a href="https://translate.it" class="btn btn-primary web-microsoft" type="button">Web</a>
        </div>
    </div>

    <h3 class="mt-3">Papago</h3>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://papago.naver.com/" class="btn btn-primary app-papago" type="button">App</a>
        </div>
        <div class="col d-grid">
            <a href="https://papago.naver.com/" class="btn btn-primary web-papago" type="button">Web</a>
        </div>
    </div>

    <h2 class="mt-3">VoiceTra</h2>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/text.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-dark"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/microphone.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/camera--v1.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/ios-glyphs/30/FFFFFF/chat.png" width="14px"></span>
    <span class="badge rounded-pill text-bg-light"><img src="https://img.icons8.com/material-outlined/24/FFFFFF/sign-up.png" width="14px"></span>
    <div class="row">
        <div class="col d-grid">
            <a href="https://voicetra.nict.go.jp/" class="btn btn-primary app-voicetra" type="button">App</a>
        </div>
        <div class="col d-grid"></div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyUUS9qijnORQTAxUzVXLlsDigodcNn-uANaFjQpiRXqS5mQcIFlNRWYerSkzELOc5d/exec";
    const LIFF_ID = "2005594923-wN8OjyGd";
    const APP_URL = {
        deepl: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id1552407475',
            IPHONE_URL_SCHEME: 'deepl://',
            IPHONE_UNI_LINK: 'https://deepl.com',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=com.deepl.mobiletranslator',
            ANDROID_URL_SCHEME: '',
            CHROME_URL_SCHEME: '',
            ANDROID_APP_LINK: '',
            WEB_URL: 'https://deepl.com'
        },
        google: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id414706506',
            IPHONE_URL_SCHEME: 'googletranslate://',
            IPHONE_UNI_LINK: 'https://translate.google.com/m/translate',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=com.google.android.apps.translate',
            ANDROID_URL_SCHEME: 'googletranslate://*/open',
            CHROME_URL_SCHEME: 'intent://*/open/#Intent;scheme=googletranslate;package=com.google.android.apps.translate;end',
            ANDROID_APP_LINK: 'https://translate.google.com/m/translate',
            WEB_URL: 'https://translate.google.com'
        },
        iTranslate: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id288113403',
            IPHONE_URL_SCHEME: '',
            IPHONE_UNI_LINK: 'https://whfs.app.link',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=at.nk.tools.iTranslate',
            ANDROID_URL_SCHEME: '',
            CHROME_URL_SCHEME: '',
            ANDROID_APP_LINK: 'https://whfs.app.link',
            WEB_URL: ""
        },
        microsoft: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id1018949559',
            IPHONE_URL_SCHEME: '',
            IPHONE_UNI_LINK: '',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=com.microsoft.translator',
            ANDROID_URL_SCHEME: '',
            CHROME_URL_SCHEME: '',
            ANDROID_APP_LINK: '',//オプションリンク
            WEB_URL: 'https://translate.it'
        },
        papago: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id1147874819',
            IPHONE_URL_SCHEME: '',
            IPHONE_UNI_LINK: '',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=com.naver.labs.translator',
            ANDROID_URL_SCHEME: '',
            CHROME_URL_SCHEME: '',
            ANDROID_APP_LINK: '',
            WEB_URL: 'https://papago.naver.com/'
        },
        voicetra: {
            IPHONE_STORE_URL: 'https://apps.apple.com/app/id581137577',
            IPHONE_URL_SCHEME: '',
            IPHONE_UNI_LINK: '',
            ANDROID_STORE_URL: 'https://play.google.com/store/apps/details?id=jp.go.nict.voicetra',
            ANDROID_URL_SCHEME: '',
            CHROME_URL_SCHEME: '',
            ANDROID_APP_LINK: '',
            WEB_URL: ''
        },
    }

    const appList = Object.keys(APP_URL);
    for(let i = 0; i < appList.length; i ++) {
        $(`.app-${appList[i]}`).on("click", function (e) {
            const ret = lunchApp(appList[i]);
            if (!ret) {
                e.preventDefault();
            }
        });
    }
    $(".loader").hide();

    // liff.init({
    //     liffId: LIFF_ID, // Use own liffId
    //     withLoginOnExternalBrowser: true, // Enable automatic login process
    // }).then(() => {
    //     // Start to use liff's api
    //     const idToken = liff.getIDToken();
    //     const appList = Object.keys(APP_URL);
    //     for(let i = 0; i < appList.length; i ++) {
    //         $(`.app-${appList[i]}`).on("click", function (e) {
    //             const ret = lunchApp(appList[i]);
    //             if (!ret) {
    //                 e.preventDefault();
    //             }
    //         });
    //     }
    //     $(".loader").hide();
    //   }).catch((err) => {
    //     // Error happens during initialization
    //     liff.logout();
    //     alert("LIFF init failed.");
    // });

    function lunchApp(app) {
        function execute(appUrl, storeUrl) {
            const iframe = document.createElement('iframe');
            iframe.style.visibility = "hidden";
            iframe.src = appUrl;
            document.body.appendChild(iframe);
            const time = (new Date()).getTime();
            setTimeout(function(){
                const now = (new Date()).getTime();
                document.body.removeChild(iframe);
                if((now-time)>400) {
                    // 元の画面に戻ってきた時にポップアップを抑制するため
                    return;
                }
                document.location = storeUrl;
            }, 300);
        }

        const agent = navigator.userAgent;

        alert(agent);
        if (agent.search(/iPhone|iPod|iPad/) !== -1 || (agent.search(/ipad|macintosh/) !== -1  && "ontouchend" in document)) {
            // iPhone
            alert("iOS");
            if(APP_URL[app].IPHONE_URL_SCHEME !== ""){
                execute(APP_URL[app].IPHONE_URL_SCHEME, APP_URL[app].IPHONE_STORE_URL, false);
                return false;
            }
            else if(APP_URL[app].IPHONE_UNI_LINK !== ""){
                $(`.app-${app}`).attr('href', APP_URL[app].IPHONE_UNI_LINK);
                return true;
            }
            else{
                $(`.app-${app}`).attr('href', APP_URL[app].IPHONE_STORE_URL);
                return true;
            }
        } else if (agent.search(/Android/) !== -1 && agent.search(/Chrome/) !== -1) {
            // Chrome in Android
            // https://developer.chrome.com/multidevice/android/intentsを参考。
            if(APP_URL[app].CHROME_URL_SCHEME !== ""){
                $(`.app-${app}`).attr('href', APP_URL[app].CHROME_URL_SCHEME);
                return true;
            }
            else if(APP_URL[app].ANDROID_APP_LINK !== ""){
                $(`.app-${app}`).attr('href', APP_URL[app].ANDROID_APP_LINK);
                return true;
            }
            else{
                $(`.app-${app}`).attr('href', APP_URL[app].ANDROID_STORE_URL);
                return true;
            }
        } else if (agent.search(/Android/) !== -1) {
            // Android
            if(APP_URL[app].ANDROID_URL_SCHEME !== ""){
                execute(APP_URL[app].ANDROID_URL_SCHEME, APP_URL[app].ANDROID_STORE_URL, false);
                return false;
            }
            else if(APP_URL[app].ANDROID_APP_LINK !== ""){
                $(`.app-${app}`).attr('href', APP_URL[app].ANDROID_APP_LINK);
                return true;
            }
            else{
                $(`.app-${app}`).attr('href', APP_URL[app].ANDROID_STORE_URL);
                return true;
            }
        }

        return true;
    }

</script>

</body>
</html>
